parameters:
  - name: dockerfilePath
    type: string

steps:
- task: DownloadBuildArtifacts@1
  inputs:
    buildType: "current"
    downloadType: "single"
    artifactName: "$(Build.BuildId)-drop"
    downloadPath: "$(System.ArtifactsDirectory)"
  displayName: "Download Build Artifacts"

- task: Docker@2
  displayName: 'Build docker image and push to ACR'
  inputs:
    command: buildAndPush
    containerRegistry: $(ACR_SERVICE_CONNECTION)
    repository: ${{ parameters.dockerImageName }}
    dockerfile: '${{ parameters.dockerfilePath }}'
    buildContext: '$(System.ArtifactsDirectory)/$(Build.BuildId)-drop'
    tags: |
      $(Build.BuildId)
      latest